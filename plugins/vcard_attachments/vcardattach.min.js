/**
 * vcard_attachments plugin script
 *
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this file.
 *
 * Copyright (c) The Roundcube Dev Team
 *
 * The JavaScript code in this page is free software: you can redistribute it
 * and/or modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation, either version 3 of
 * the License, or (at your option) any later version.
 *
 * @licend  The above is the entire license notice
 * for the JavaScript code in this file.
 */
function plugin_vcard_save_contact(a){var b=rcmail.set_busy(!0,"loading");rcmail.http_post("plugin.savevcard",{_uid:rcmail.env.uid,_mbox:rcmail.env.mailbox,_part:a},b);return!1}function plugin_vcard_insertrow(a){a.row.ctype.match(/^(text\/vcard|text\/x-vcard|text\/directory)$/i)&&$(a.row.obj).find(".attachment > .attachment").addClass("vcard")}
function plugin_vcard_attach(){var a,b,c=[],f=(new Date).getTime(),d={_uploadid:f,_id:rcmail.env.compose_id||null},e=rcmail.contact_list.get_selection();for(b=0;b<e.length;b++)"addressbook"==rcmail.env.task?(a=e[b],c.push(rcmail.env.source+"-"+a+"-0")):(a=e[b])&&"E"!=a.charAt(0)&&rcmail.env.contactdata[a]&&c.push(a);if(!c.length)return!1;d._uri="vcard://"+c.join(",");"addressbook"==rcmail.env.task?(d._attach_vcard=1,rcmail.open_compose_step(d)):(rcmail.add2attachment_list(f,{name:"",html:rcmail.get_label("attaching"),
classname:"uploading",complete:!1})||(rcmail.file_upload_id=rcmail.set_busy(!0,"attaching")),rcmail.http_post("upload",d))}
window.rcmail&&rcmail.addEventListener("init",function(a){rcmail.gui_objects.messagelist&&rcmail.addEventListener("insertrow",function(a,b){plugin_vcard_insertrow(a)});if(("compose"==rcmail.env.action||"addressbook"==rcmail.env.task&&""==rcmail.env.action)&&rcmail.gui_objects.contactslist){if("compose"==rcmail.env.action&&(rcmail.env.compose_commands.push("attach-vcard"),window.UI&&UI.recipient_selector)){var b;a=$("#compose-attachments > div");b=$('<button class="btn btn-secondary attach vcard">').attr({type:"button",
tabindex:$("button,input",a).first().attr("tabindex")||0}).text(rcmail.gettext("vcard_attachments.attachvcard")).appendTo(a).click(function(){UI.recipient_selector("",{title:"vcard_attachments.attachvcard",button:"vcard_attachments.attachvcard",button_class:"attach",focus:b,multiselect:!1,action:function(){rcmail.command("attach-vcard")}})})}rcmail.register_command("attach-vcard",function(){plugin_vcard_attach()});rcmail.contact_list.addEventListener("select",function(a){a=a.get_selection();rcmail.enable_command("attach-vcard",
1==a.length&&"E"!=a[0].charAt(0))})}});
